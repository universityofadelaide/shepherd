root_dir: /backup
backup_title: '[current-date:medium] - [shepherd:environment-type]'
backup_command: "echo \"Ensuring backup destination directories exist\"\nmkdir -p [shepherd:backup-path]/files\nmkdir -p [shepherd:backup-path]/private\necho \"Backing up public files\"\nrsync -a [shepherd:site-public-files] [shepherd:backup-path]/files/\necho \"Backing up private files\"\nrsync -a [shepherd:site-private-files] [shepherd:backup-path]/private/\necho \"Backing up database\"\ndrush -r /code/web sql-dump --structure-tables-list=cache_bootstrap,cache_config,cache_container,cache_data,cache_default,cache_discovery,cache_dynamic_page_cache,cache_entity,cache_menu,cache_render,cache_rest,cache_toolbar,cachetags --result-file=[shepherd:backup-path]/database.sql\necho \"Backup complete\"\n"
restore_command: "echo \"Dropping database\"\ndrush -y -r /code/web sql-drop\necho \"Restoring database from backup\"\ndrush -r /code/web sqlq --file=[shepherd:backup-path]/database.sql\necho \"Restoring files\"\nrsync -a --delete [shepherd:backup-path]/files/ [shepherd:site-public-files] || true\necho \"Restoring private files\"\nrsync -a --delete [shepherd:backup-path]/private/ [shepherd:site-private-files] || true\necho \"Applying drupal updates\"\ndrush -r /code/web cr || true\ndrush -r /code/web -y --entity-updates updb || true\nrobo config:import-plus || true\ndrush -r /code/web -y entity-updates || true\necho \"Clearing cache\"\ndrush -r /code/web cr\necho \"Restore complete\"\n"
_core:
  default_config_hash: XUa0Nvk6x9WfhqPBqH07RQkeHlmnxJ_8wTG0nGZguUs
